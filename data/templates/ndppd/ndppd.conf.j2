########################################################
#
# autogenerated by nat66.py
#
#   The configuration file must define one upstream
#   interface.
#
#   For some services, such as nat66, because it runs
#    stateless, it needs to rely on NDP Proxy to respond
#   to NDP requests.
#
#   When using nat66 source rules, NDP Proxy needs
#   to be enabled
#
########################################################

{% set global = namespace(ndppd_interfaces = [],ndppd_prefixs = []) %}
{% if source.rule is vyos_defined %}
{%     for rule, config in source.rule.items() if config.disable is not defined %}
{%         if config.outbound_interface.name is vyos_defined %}
{%             if config.outbound_interface.name not in global.ndppd_interfaces %}
{%                 set global.ndppd_interfaces = global.ndppd_interfaces + [config.outbound_interface.name] %}
{%             endif   %}
{%             if config.translation.address is vyos_defined and config.translation.address | is_ip_network %}
{%                 set global.ndppd_prefixs = global.ndppd_prefixs + [{'interface':config.outbound_interface.name,'rule':config.translation.address}] %}
{%             endif %}
{%         endif %}
{%     endfor %}
{% endif %}

{% for interface in global.ndppd_interfaces %}
proxy {{ interface }} {
    router yes
    timeout 500
    ttl 30000
{%     for map in global.ndppd_prefixs %}
{%         if map.interface == interface %}
    rule {{ map.rule }} {
        static
    }
{%         endif  %}
{%     endfor   %}
}
{% endfor %}
